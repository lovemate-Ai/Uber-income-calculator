<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Trip Fare Suggestion Calculator</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<style>
  *{box-sizing:border-box;font-family:"Poppins",sans-serif;margin:0;padding:0;}
  body{
    background:linear-gradient(135deg,#283E51,#485563);
    color:#fff;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:flex-start;
    height:100vh;
  }
  h2{margin:15px 0;font-size:1.6rem;color:#00ffcc;text-align:center;}
  #map{height:300px;width:90%;border-radius:15px;margin-bottom:10px;}
  .form-box{
    width:90%;
    background:rgba(255,255,255,0.1);
    backdrop-filter:blur(8px);
    border-radius:15px;
    padding:20px;
    box-shadow:0 8px 20px rgba(0,0,0,0.3);
  }
  label{display:block;margin-top:10px;font-weight:600;}
  input,select{
    width:100%;
    padding:10px;
    margin-top:5px;
    border:none;
    border-radius:8px;
    background:rgba(255,255,255,0.2);
    color:#fff;
    font-size:15px;
    outline:none;
  }
  button{
    width:100%;
    margin-top:15px;
    padding:12px;
    border:none;
    background:#00c853;
    color:#fff;
    border-radius:10px;
    font-size:16px;
    cursor:pointer;
    transition:0.3s;
  }
  button:hover{background:#009624;transform:scale(1.03);}
  .result{
    margin-top:15px;
    padding:15px;
    background:rgba(0,0,0,0.3);
    border-radius:12px;
  }
</style>
</head>
<body>

<h2>üöò Smart Trip Fare Suggestion Calculator</h2>
<div id="map"></div>

<div class="form-box">
  <label>‡¶´‡ßÅ‡¶Ø‡¶º‡ßá‡¶≤ ‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶∏ (‡ß≥ ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞):</label>
  <input type="number" id="fuelPrice" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 130">

  <label>‡¶ó‡¶æ‡ßú‡¶ø‡¶∞ ‡¶Æ‡¶æ‡¶á‡¶≤‡ßá‡¶ú (‡¶ï‡¶ø‡¶Æ‡¶ø ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞):</label>
  <input type="number" id="mileage" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 12">

  <label>‡¶ó‡¶æ‡ßú‡¶ø‡¶∞ ‡¶ü‡¶æ‡¶á‡¶™:</label>
  <select id="carType">
    <option value="nonac">Non-AC</option>
    <option value="ac">AC</option>
    <option value="premium">Premium</option>
  </select>

  <label>‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§ ‡¶ñ‡¶∞‡¶ö (‡¶ü‡ßã‡¶≤/‡¶™‡¶æ‡¶∞‡ßç‡¶ï‡¶ø‡¶Ç ‡¶á‡¶§‡ßç‡¶Ø‡¶æ‡¶¶‡¶ø):</label>
  <input type="number" id="extraCost" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 100">

  <button onclick="calculateFare()">‡¶∏‡¶æ‡¶ú‡ßá‡¶∏‡ßç‡¶ü‡ßá‡¶° ‡¶≠‡¶æ‡ßú‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶ì</button>
  <div class="result" id="result">üó∫Ô∏è ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶¶‡ßÅ‡¶á‡¶ü‡¶ø ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® (Start & Destination)</div>
</div>

<script>
let map = L.map('map').setView([23.8103, 90.4125], 11);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution:'¬© OpenStreetMap contributors'
}).addTo(map);

let points = [];
let routeLine;

map.on('click', function(e){
  points.push(e.latlng);
  L.marker(e.latlng).addTo(map);
  if(points.length === 2){
    drawRoute();
  }
});

function drawRoute(){
  if(routeLine){ map.removeLayer(routeLine); }
  routeLine = L.polyline(points, {color:'lime', weight:4}).addTo(map);
  map.fitBounds(routeLine.getBounds());
  getDistance();
}

function getDistance(){
  const [p1, p2] = points;
  const R = 6371;
  const dLat = (p2.lat - p1.lat) * Math.PI / 180;
  const dLon = (p2.lng - p1.lng) * Math.PI / 180;
  const a = Math.sin(dLat/2)**2 + Math.cos(p1.lat*Math.PI/180)*Math.cos(p2.lat*Math.PI/180)*Math.sin(dLon/2)**2;
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  const distance = R * c;
  window.tripDistance = distance.toFixed(2);
  document.getElementById("result").innerHTML = `üìç ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶¶‡ßÇ‡¶∞‡¶§‡ßç‡¶¨: <b>${distance.toFixed(2)} ‡¶ï‡¶ø‡¶Æ‡¶ø</b>`;
}

function calculateFare(){
  const fuelPrice = parseFloat(document.getElementById("fuelPrice").value)||0;
  const mileage = parseFloat(document.getElementById("mileage").value)||0;
  const carType = document.getElementById("carType").value;
  const extraCost = parseFloat(document.getElementById("extraCost").value)||0;
  const distance = parseFloat(window.tripDistance)||0;

  if(distance === 0){
    alert("‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™‡ßá Start ‡¶ì Destination ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®!");
    return;
  }

  if(fuelPrice<=0 || mileage<=0){
    alert("‡¶´‡ßÅ‡¶Ø‡¶º‡ßá‡¶≤ ‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶∏ ‡¶ì ‡¶Æ‡¶æ‡¶á‡¶≤‡ßá‡¶ú ‡¶¶‡¶ø‡¶§‡ßá ‡¶π‡¶¨‡ßá!");
    return;
  }

  const fuelNeeded = distance / mileage;
  const fuelCost = fuelNeeded * fuelPrice;

  let baseProfit = 0;
  if(carType === "nonac") baseProfit = 0.25;
  if(carType === "ac") baseProfit = 0.35;
  if(carType === "premium") baseProfit = 0.5;

  const driverProfit = fuelCost * baseProfit;
  const totalFare = fuelCost + driverProfit + extraCost;
  const perKm = totalFare / distance;

  const msg = `
    üõ£Ô∏è ‡¶¶‡ßÇ‡¶∞‡¶§‡ßç‡¶¨: ${distance.toFixed(2)} ‡¶ï‡¶ø‡¶Æ‡¶ø<br>
    ‚õΩ ‡¶´‡ßÅ‡¶Ø‡¶º‡ßá‡¶≤ ‡¶≤‡¶æ‡¶ó‡¶¨‡ßá: ${fuelNeeded.toFixed(2)} ‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞<br>
    üí∞ ‡¶´‡ßÅ‡¶Ø‡¶º‡ßá‡¶≤ ‡¶ñ‡¶∞‡¶ö: ‡ß≥${fuelCost.toFixed(2)}<br>
    üöó ‡¶ó‡¶æ‡ßú‡¶ø‡¶∞ ‡¶ü‡¶æ‡¶á‡¶™: ${carType.toUpperCase()}<br>
    üíº ‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡¶æ‡¶∞ ‡¶≤‡¶æ‡¶≠ (‡¶Ü‡¶®‡ßÅ‡¶Æ‡¶æ‡¶®‡¶ø‡¶ï): ‡ß≥${driverProfit.toFixed(2)}<br>
    üßæ ‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§ ‡¶ñ‡¶∞‡¶ö: ‡ß≥${extraCost.toFixed(2)}<br><br>
    ‚úÖ <strong>‡¶™‡¶æ‡¶∞‡¶´‡ßá‡¶ï‡ßç‡¶ü ‡¶∏‡¶æ‡¶ú‡ßá‡¶∏‡ßç‡¶ü‡ßá‡¶° ‡¶≠‡¶æ‡ßú‡¶æ: ‡ß≥${totalFare.toFixed(2)}</strong><br>
    üìç ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶ï‡¶ø‡¶Æ‡¶ø‡¶§‡ßá: ‡ß≥${perKm.toFixed(2)}
  `;
  document.getElementById("result").innerHTML = msg;
  speak(`‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶≠‡¶æ‡ßú‡¶æ ‡¶Ü‡¶®‡ßÅ‡¶Æ‡¶æ‡¶®‡¶ø‡¶ï ${totalFare.toFixed(0)} ‡¶ü‡¶æ‡¶ï‡¶æ, ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶ï‡¶ø‡¶≤‡ßã‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞‡ßá ${perKm.toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ‡•§`);
}

function speak(text){
  if('speechSynthesis' in window){
    const u = new SpeechSynthesisUtterance(text);
    u.lang = 'bn-BD';
    window.speechSynthesis.speak(u);
  }
}
</script>
</body>
</html>
